import{_ as B}from"./InputError.vue_vue_type_script_setup_true_lang-BltmWT9M.js";import{_ as I}from"./FlashMessages.vue_vue_type_script_setup_true_lang-DzlBP8Dr.js";import{d as N,g as b,q as R,c as o,b as l,a as d,u as f,t as C,e as V,w as $,x as U,D as T,o as r,N as j,f as P}from"./app-DW2KkjvG.js";import{c as A}from"./createLucideIcon-DK4FZEuV.js";import{_ as z}from"./Input.vue_vue_type_script_setup_true_lang--CnlkcD7.js";const M=A("CameraIcon",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const q=A("CircleUserRoundIcon",[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const L=A("ImagePlusIcon",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]),E={class:"space-y-4"},F=["name"],S={class:"flex items-center gap-4"},D={class:"h-24 w-24 overflow-hidden rounded-full border border-border bg-background"},G=["src"],H={key:1,class:"flex h-full w-full items-center justify-center text-muted-foreground"},O={class:"space-y-1"},X={class:"font-medium"},J={class:"pointer-events-none absolute right-3 bottom-3 inline-flex items-center gap-1 rounded-md border border-border bg-background px-2 py-1 text-xs text-muted-foreground transition group-hover:text-foreground"},W={class:"flex items-center gap-2"},ie=N({__name:"AvatarUpload",props:{modelValue:{},currentAvatar:{default:null},name:{default:"avatar"}},emits:["update:modelValue"],setup(i,{emit:_}){const s=i,u=_,k=T(),t=b(s.currentAvatar),n=b(null);R(()=>s.currentAvatar,p=>{s.modelValue===null&&(t.value=p??null)});const x=U(()=>k.props.errors?.[s.name]??null),m=p=>{const v=p.target.files?.[0]??null;if(u("update:modelValue",v),v===null){t.value=s.currentAvatar??null;return}const h=new FileReader;h.onload=()=>{t.value=h.result},h.readAsDataURL(v)},g=()=>{n.value?.click()},y=()=>{u("update:modelValue",null),t.value=s.currentAvatar??null,n.value!==null&&(n.value.value="")};return(p,a)=>(r(),o("div",E,[l("input",{ref_key:"fileInput",ref:n,name:i.name,type:"file",accept:".jpg,.jpeg,.png,.webp,.gif,.avif",class:"hidden",onChange:m},null,40,F),l("button",{type:"button",class:"group relative w-full overflow-hidden rounded-xl border border-dashed border-border bg-muted/40 p-4 text-left transition hover:border-primary",onClick:g},[l("div",S,[l("div",D,[t.value?(r(),o("img",{key:0,src:t.value,alt:"Avatar preview",class:"h-full w-full object-cover"},null,8,G)):(r(),o("div",H,[d(f(q),{class:"h-12 w-12"})]))]),l("div",O,[l("p",X,C(t.value?"Change profile photo":"Choose profile photo"),1),a[0]||(a[0]=l("p",{class:"text-xs text-muted-foreground"}," JPG, PNG, WEBP, GIF, or AVIF up to 20MB ",-1)),a[1]||(a[1]=l("p",{class:"text-xs text-muted-foreground"}," Tap to open picker and preview instantly ",-1))])]),l("span",J,[d(f(M),{class:"h-3.5 w-3.5"}),a[2]||(a[2]=V(" Pick ",-1))])]),l("div",W,[d(f(I),{type:"button",variant:"outline",size:"sm",onClick:g},{default:$(()=>[d(f(L),{class:"mr-1 h-4 w-4"}),V(" "+C(t.value?"Replace":"Upload"),1)]),_:1}),d(f(I),{type:"button",variant:"ghost",size:"sm",onClick:y},{default:$(()=>[...a[3]||(a[3]=[V(" Clear ",-1)])]),_:1})]),d(B,{message:x.value},null,8,["message"])]))}}),K={class:"grid gap-2"},Q={class:"relative"},Y={key:0,class:"text-xs text-muted-foreground"},Z={key:0,class:"text-destructive"},ee={key:1},te={key:2,class:"text-green-600"},ae={key:3,class:"text-destructive"},ue=N({__name:"UsernameInput",props:{modelValue:{},name:{default:"username"},disabled:{type:Boolean,default:!1},checkAvailability:{type:Boolean,default:!0}},emits:["update:modelValue","availability"],setup(i,{emit:_}){const s=i,u=_,k=T(),t=b(!1),n=b(null),x=/^[a-z0-9_]+$/;let m=null;const g=U(()=>k.props.errors?.[s.name]??null),y=e=>e.replace(/^@+/,"").toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").replace(/_+/g,"_").replace(/^_+|_+$/g,"").slice(0,30),p=e=>e===""?null:e.length<3?"Username must be at least 3 characters.":x.test(e)?null:"Username may only contain lowercase letters, numbers, and underscores.",a=U(()=>p(s.modelValue)),v=async e=>{if(s.checkAvailability){if(p(e)!==null){n.value=null,u("availability",null);return}t.value=!0;try{const w=await(await fetch("/api/check-username",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??""},body:JSON.stringify({username:e})})).json();n.value=w.data?.available??!1,u("availability",n.value)}catch{n.value=null,u("availability",null)}finally{t.value=!1}}};R(()=>s.modelValue,e=>{const c=y(e);if(c!==e){u("update:modelValue",c);return}m!==null&&clearTimeout(m),m=setTimeout(()=>{v(e)},400)}),j(()=>{m!==null&&clearTimeout(m)});const h=e=>{u("update:modelValue",y(e))};return(e,c)=>(r(),o("div",K,[l("div",Q,[c[1]||(c[1]=l("span",{class:"absolute top-1/2 left-3 -translate-y-1/2 text-muted-foreground"},"@",-1)),d(f(z),{name:i.name,disabled:i.disabled,"model-value":i.modelValue,class:"pl-7",placeholder:"username","onUpdate:modelValue":c[0]||(c[0]=w=>h(w))},null,8,["name","disabled","model-value"])]),i.checkAvailability?(r(),o("div",Y,[a.value?(r(),o("span",Z,C(a.value),1)):t.value?(r(),o("span",ee,"Checking availability...")):n.value===!0?(r(),o("span",te,"Username is available.")):n.value===!1?(r(),o("span",ae,"Username is not available.")):P("",!0)])):P("",!0),d(B,{message:g.value},null,8,["message"])]))}});export{ue as _,ie as a};
