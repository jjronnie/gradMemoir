import{a as R,b as S,c as T,_ as X}from"./UserMenuContent.vue_vue_type_script_setup_true_lang-CGOEXzev.js";import{d as $,g as D,q as B,A as j,G as I,p as F,w as h,a as b,u as w,e as z,t as p,b as r,C as M,c as u,F as O,r as q,f as v,x as _,o as l}from"./app-DW2KkjvG.js";const G={class:"space-y-4"},K=["src"],H={key:0,class:"space-y-1 text-sm text-muted-foreground"},J={key:0},Q={key:1},W={class:"space-y-1 text-center"},Y={class:"text-xs text-muted-foreground"},Z={key:0,class:"text-xs text-muted-foreground"},ne=$({__name:"PhotoCarousel",props:{modelValue:{type:Boolean},photos:{},initialIndex:{default:0},title:{default:"Photo"},description:{default:null}},emits:["update:modelValue"],setup(y,{emit:L}){const i=y,P=L,o=D(i.initialIndex),f=D(null);B(()=>i.initialIndex,e=>{o.value=e});const s=_(()=>i.photos.map(e=>typeof e=="string"?{url:e,description:i.description??null,postedDiff:null,postedAt:null,downloadName:null}:{url:e.full??e.url??e.thumb??"",description:e.description??i.description??null,postedDiff:e.postedDiff??null,postedAt:e.postedAt??null,downloadName:e.downloadName??null})),n=_(()=>s.value[o.value]??null),c=_(()=>s.value.length>1),U=_(()=>({transform:`translateX(-${o.value*100}%)`})),g=()=>{c.value&&(o.value=(o.value-1+s.value.length)%s.value.length)},x=()=>{c.value&&(o.value=(o.value+1)%s.value.length)},k=e=>{!i.modelValue||!c.value||(e.key==="ArrowLeft"&&g(),e.key==="ArrowRight"&&x())},V=e=>{c.value&&(f.value=e.touches[0]?.clientX??null)},C=e=>{if(!c.value||f.value===null)return;const a=e.changedTouches[0]?.clientX;if(typeof a!="number"){f.value=null;return}const t=a-f.value;Math.abs(t)>=40&&(t>0?g():x()),f.value=null},E=e=>{try{const d=new URL(e,window.location.origin).pathname.split("/").pop()??"";return d!==""?d:"photo.webp"}catch{return"photo.webp"}},A=async()=>{if(!n.value||n.value.url==="")return;const e=n.value.url,a=n.value.downloadName??E(e);try{const t=await fetch(e);if(!t.ok)throw new Error("Unable to download image");const d=await t.blob(),N=window.URL.createObjectURL(d),m=document.createElement("a");m.href=N,m.download=a,document.body.appendChild(m),m.click(),m.remove(),window.URL.revokeObjectURL(N)}catch{window.open(e,"_blank","noopener,noreferrer")}};return j(()=>{window.addEventListener("keydown",k)}),I(()=>{window.removeEventListener("keydown",k)}),(e,a)=>(l(),F(w(X),{open:y.modelValue,"onUpdate:open":a[0]||(a[0]=t=>P("update:modelValue",t))},{default:h(()=>[b(w(R),{class:"scrollbar-hide max-h-[94vh] w-[min(95vw,72rem)] overflow-y-auto"},{default:h(()=>[b(w(S),null,{default:h(()=>[b(w(T),null,{default:h(()=>[z(p(y.title),1)]),_:1})]),_:1}),r("div",G,[r("div",{class:"overflow-hidden rounded-lg",onTouchstartPassive:V,onTouchendPassive:C},[r("div",{class:"flex transition-transform duration-300 ease-out will-change-transform",style:M(U.value)},[(l(!0),u(O,null,q(s.value,(t,d)=>(l(),u("div",{key:`carousel-photo-${d}`,class:"w-full shrink-0"},[t.url?(l(),u("img",{key:0,src:t.url,alt:"Photo",class:"max-h-[72vh] w-full select-none object-contain",loading:"eager",draggable:"false"},null,8,K)):v("",!0)]))),128))],4)],32),n.value?.description||n.value?.postedDiff?(l(),u("div",H,[n.value?.description?(l(),u("p",J,p(n.value.description),1)):v("",!0),n.value?.postedDiff?(l(),u("p",Q," Posted "+p(n.value.postedDiff),1)):v("",!0)])):v("",!0),r("div",{class:"flex items-center justify-center"},[r("button",{type:"button",class:"rounded-md border px-4 py-1.5 text-sm hover:bg-accent",onClick:A}," Download ")]),r("div",W,[r("p",Y,p(o.value+1)+" / "+p(s.value.length),1),c.value?(l(),u("p",Z," Swipe left or right to browse photos. ")):v("",!0)])])]),_:1})]),_:1},8,["open"]))}});export{ne as _};
