import{d as at,B as Rt,p as zt,y as Ot,c as g,b as o,f as E,s as it,F,r as N,C as Gt,g as k,x as f,t as u,q as Z,w as K,o as d,u as V,l as st,D as Dt,E as Lt,a as j,h as qt,e as kt,i as _t,G as Yt}from"./app-V76evz6G.js";import{_ as Et}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ut}from"./ShareButton.vue_vue_type_script_setup_true_lang-B6yWi2MA.js";import{_ as Nt}from"./Input.vue_vue_type_script_setup_true_lang-TncQ48jP.js";import{_ as jt}from"./PublicLayout.vue_vue_type_script_setup_true_lang-AHOsUcUi.js";import"./FlashMessages.vue_vue_type_script_setup_true_lang-CRIGBRWp.js";import"./index-Sn8BDqwf.js";import"./index-hQ9SfOkF.js";import"./UserMenuContent.vue_vue_type_script_setup_true_lang-Dr8b2uXp.js";import"./useForwardPropsEmits-Do_0Ola4.js";import"./RovingFocusGroup-C17lhl7u.js";import"./useForwardExpose-FvI28VS4.js";import"./createLucideIcon-D8DlfC-D.js";import"./index-ueziRkVZ.js";var Q={exports:{}},Vt=Q.exports,Ct;function Zt(){return Ct||(Ct=1,(function(m,y){(function(W,I){I(y)})(Vt,(function(W){class I{constructor(t,e){this.state={angle:0,area:[],position:{x:0,y:0},hardAngle:0,hardDrawingAngle:0},this.createdDensity=e,this.nowDrawingDensity=this.createdDensity,this.render=t}setDensity(t){this.createdDensity=t,this.nowDrawingDensity=t}setDrawingDensity(t){this.nowDrawingDensity=t}setPosition(t){this.state.position=t}setAngle(t){this.state.angle=t}setArea(t){this.state.area=t}setHardDrawingAngle(t){this.state.hardDrawingAngle=t}setHardAngle(t){this.state.hardAngle=t,this.state.hardDrawingAngle=t}setOrientation(t){this.orientation=t}getDrawingDensity(){return this.nowDrawingDensity}getDensity(){return this.createdDensity}getHardAngle(){return this.state.hardAngle}}class T extends I{constructor(t,e,s){super(t,s),this.image=null,this.isLoad=!1,this.loadingAngle=0,this.image=new Image,this.image.src=e}draw(t){const e=this.render.getContext(),s=this.render.convertToGlobal(this.state.position),i=this.render.getRect().pageWidth,n=this.render.getRect().height;e.save(),e.translate(s.x,s.y),e.beginPath();for(let r of this.state.area)r!==null&&(r=this.render.convertToGlobal(r),e.lineTo(r.x-s.x,r.y-s.y));e.rotate(this.state.angle),e.clip(),this.isLoad?e.drawImage(this.image,0,0,i,n):this.drawLoader(e,{x:0,y:0},i,n),e.restore()}simpleDraw(t){const e=this.render.getRect(),s=this.render.getContext(),i=e.pageWidth,n=e.height,r=t===1?e.left+e.pageWidth:e.left,h=e.top;this.isLoad?s.drawImage(this.image,r,h,i,n):this.drawLoader(s,{x:r,y:h},i,n)}drawLoader(t,e,s,i){t.beginPath(),t.strokeStyle="rgb(200, 200, 200)",t.fillStyle="rgb(255, 255, 255)",t.lineWidth=1,t.rect(e.x+1,e.y+1,s-1,i-1),t.stroke(),t.fill();const n={x:e.x+s/2,y:e.y+i/2};t.beginPath(),t.lineWidth=10,t.arc(n.x,n.y,20,this.loadingAngle,3*Math.PI/2+this.loadingAngle),t.stroke(),t.closePath(),this.loadingAngle+=.07,this.loadingAngle>=2*Math.PI&&(this.loadingAngle=0)}load(){this.isLoad||(this.image.onload=()=>{this.isLoad=!0})}newTemporaryCopy(){return this}getTemporaryCopy(){return this}hideTemporaryCopy(){}}class _{constructor(t,e){this.pages=[],this.currentPageIndex=0,this.currentSpreadIndex=0,this.landscapeSpread=[],this.portraitSpread=[],this.render=e,this.app=t,this.currentPageIndex=0,this.isShowCover=this.app.getSettings().showCover}destroy(){this.pages=[]}createSpread(){this.landscapeSpread=[],this.portraitSpread=[];for(let e=0;e<this.pages.length;e++)this.portraitSpread.push([e]);let t=0;this.isShowCover&&(this.pages[0].setDensity("hard"),this.landscapeSpread.push([t]),t++);for(let e=t;e<this.pages.length;e+=2)e<this.pages.length-1?this.landscapeSpread.push([e,e+1]):(this.landscapeSpread.push([e]),this.pages[e].setDensity("hard"))}getSpread(){return this.render.getOrientation()==="landscape"?this.landscapeSpread:this.portraitSpread}getSpreadIndexByPage(t){const e=this.getSpread();for(let s=0;s<e.length;s++)if(t===e[s][0]||t===e[s][1])return s;return null}getPageCount(){return this.pages.length}getPages(){return this.pages}getPage(t){if(t>=0&&t<this.pages.length)return this.pages[t];throw new Error("Invalid page number")}nextBy(t){const e=this.pages.indexOf(t);return e<this.pages.length-1?this.pages[e+1]:null}prevBy(t){const e=this.pages.indexOf(t);return e>0?this.pages[e-1]:null}getFlippingPage(t){const e=this.currentSpreadIndex;if(this.render.getOrientation()==="portrait")return t===0?this.pages[e].newTemporaryCopy():this.pages[e-1];{const s=t===0?this.getSpread()[e+1]:this.getSpread()[e-1];return s.length===1||t===0?this.pages[s[0]]:this.pages[s[1]]}}getBottomPage(t){const e=this.currentSpreadIndex;if(this.render.getOrientation()==="portrait")return t===0?this.pages[e+1]:this.pages[e-1];{const s=t===0?this.getSpread()[e+1]:this.getSpread()[e-1];return s.length===1?this.pages[s[0]]:t===0?this.pages[s[1]]:this.pages[s[0]]}}showNext(){this.currentSpreadIndex<this.getSpread().length&&(this.currentSpreadIndex++,this.showSpread())}showPrev(){this.currentSpreadIndex>0&&(this.currentSpreadIndex--,this.showSpread())}getCurrentPageIndex(){return this.currentPageIndex}show(t=null){if(t===null&&(t=this.currentPageIndex),t<0||t>=this.pages.length)return;const e=this.getSpreadIndexByPage(t);e!==null&&(this.currentSpreadIndex=e,this.showSpread())}getCurrentSpreadIndex(){return this.currentSpreadIndex}setCurrentSpreadIndex(t){if(!(t>=0&&t<this.getSpread().length))throw new Error("Invalid page");this.currentSpreadIndex=t}showSpread(){const t=this.getSpread()[this.currentSpreadIndex];t.length===2?(this.render.setLeftPage(this.pages[t[0]]),this.render.setRightPage(this.pages[t[1]])):this.render.getOrientation()==="landscape"&&t[0]===this.pages.length-1?(this.render.setLeftPage(this.pages[t[0]]),this.render.setRightPage(null)):(this.render.setLeftPage(null),this.render.setRightPage(this.pages[t[0]])),this.currentPageIndex=t[0],this.app.updatePageIndex(this.currentPageIndex)}}class x extends _{constructor(t,e,s){super(t,e),this.imagesHref=s}load(){for(const t of this.imagesHref){const e=new T(this.render,t,"soft");e.load(),this.pages.push(e)}this.createSpread()}}class b{static GetDistanceBetweenTwoPoint(t,e){return t===null||e===null?1/0:Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static GetSegmentLength(t){return b.GetDistanceBetweenTwoPoint(t[0],t[1])}static GetAngleBetweenTwoLine(t,e){const s=t[0].y-t[1].y,i=e[0].y-e[1].y,n=t[1].x-t[0].x,r=e[1].x-e[0].x;return Math.acos((s*i+n*r)/(Math.sqrt(s*s+n*n)*Math.sqrt(i*i+r*r)))}static PointInRect(t,e){return e===null?null:e.x>=t.left&&e.x<=t.width+t.left&&e.y>=t.top&&e.y<=t.top+t.height?e:null}static GetRotatedPoint(t,e,s){return{x:t.x*Math.cos(s)+t.y*Math.sin(s)+e.x,y:t.y*Math.cos(s)-t.x*Math.sin(s)+e.y}}static LimitPointToCircle(t,e,s){if(b.GetDistanceBetweenTwoPoint(t,s)<=e)return s;const i=t.x,n=t.y,r=s.x,h=s.y;let p=Math.sqrt(Math.pow(e,2)*Math.pow(i-r,2)/(Math.pow(i-r,2)+Math.pow(n-h,2)))+i;s.x<0&&(p*=-1);let S=(p-i)*(n-h)/(i-r)+n;return i-r+n===0&&(S=e),{x:p,y:S}}static GetIntersectBetweenTwoSegment(t,e,s){return b.PointInRect(t,b.GetIntersectBeetwenTwoLine(e,s))}static GetIntersectBeetwenTwoLine(t,e){const s=t[0].y-t[1].y,i=e[0].y-e[1].y,n=t[1].x-t[0].x,r=e[1].x-e[0].x,h=t[0].x*t[1].y-t[1].x*t[0].y,p=e[0].x*e[1].y-e[1].x*e[0].y,S=s*p-i*h,C=n*p-r*h,M=-(h*r-p*n)/(s*r-i*n),U=-(s*p-i*h)/(s*r-i*n);if(isFinite(M)&&isFinite(U))return{x:M,y:U};if(Math.abs(S-C)<.1)throw new Error("Segment included");return null}static GetCordsFromTwoPoint(t,e){const s=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y),n=Math.max(s,i),r=[t];function h(p,S,C,M,U){return S>p?p+U*(C/M):S<p?p-U*(C/M):p}for(let p=1;p<=n;p+=1)r.push({x:h(t.x,e.x,s,n,p),y:h(t.y,e.y,i,n,p)});return r}}class L extends I{constructor(t,e,s){super(t,s),this.copiedElement=null,this.temporaryCopy=null,this.isLoad=!1,this.element=e,this.element.classList.add("stf__item"),this.element.classList.add("--"+s)}newTemporaryCopy(){return this.nowDrawingDensity==="hard"?this:(this.temporaryCopy===null&&(this.copiedElement=this.element.cloneNode(!0),this.element.parentElement.appendChild(this.copiedElement),this.temporaryCopy=new L(this.render,this.copiedElement,this.nowDrawingDensity)),this.getTemporaryCopy())}getTemporaryCopy(){return this.temporaryCopy}hideTemporaryCopy(){this.temporaryCopy!==null&&(this.copiedElement.remove(),this.copiedElement=null,this.temporaryCopy=null)}draw(t){const e=t||this.nowDrawingDensity,s=this.render.convertToGlobal(this.state.position),i=this.render.getRect().pageWidth,n=this.render.getRect().height;this.element.classList.remove("--simple");const r=`
            display: block;
            z-index: ${this.element.style.zIndex};
            left: 0;
            top: 0;
            width: ${i}px;
            height: ${n}px;
        `;e==="hard"?this.drawHard(r):this.drawSoft(s,r)}drawHard(t=""){const e=this.render.getRect().left+this.render.getRect().width/2,s=this.state.hardDrawingAngle,i=t+`
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
                clip-path: none;
                -webkit-clip-path: none;
            `+(this.orientation===0?`transform-origin: ${this.render.getRect().pageWidth}px 0; 
                   transform: translate3d(0, 0, 0) rotateY(${s}deg);`:`transform-origin: 0 0; 
                   transform: translate3d(${e}px, 0, 0) rotateY(${s}deg);`);this.element.style.cssText=i}drawSoft(t,e=""){let s="polygon( ";for(const n of this.state.area)if(n!==null){let r=this.render.getDirection()===1?{x:-n.x+this.state.position.x,y:n.y-this.state.position.y}:{x:n.x-this.state.position.x,y:n.y-this.state.position.y};r=b.GetRotatedPoint(r,{x:0,y:0},this.state.angle),s+=r.x+"px "+r.y+"px, "}s=s.slice(0,-2),s+=")";const i=e+`transform-origin: 0 0; clip-path: ${s}; -webkit-clip-path: ${s};`+(this.render.isSafari()&&this.state.angle===0?`transform: translate(${t.x}px, ${t.y}px);`:`transform: translate3d(${t.x}px, ${t.y}px, 0) rotate(${this.state.angle}rad);`);this.element.style.cssText=i}simpleDraw(t){const e=this.render.getRect(),s=e.pageWidth,i=e.height,n=t===1?e.left+e.pageWidth:e.left,r=e.top;this.element.classList.add("--simple"),this.element.style.cssText=`
            position: absolute; 
            display: block; 
            height: ${i}px; 
            left: ${n}px; 
            top: ${r}px; 
            width: ${s}px; 
            z-index: ${this.render.getSettings().startZIndex+1};`}getElement(){return this.element}load(){this.isLoad=!0}setOrientation(t){super.setOrientation(t),this.element.classList.remove("--left","--right"),this.element.classList.add(t===1?"--right":"--left")}setDrawingDensity(t){this.element.classList.remove("--soft","--hard"),this.element.classList.add("--"+t),super.setDrawingDensity(t)}}class D extends _{constructor(t,e,s,i){super(t,e),this.element=s,this.pagesElement=i}load(){for(const t of this.pagesElement){const e=new L(this.render,t,t.dataset.density==="hard"?"hard":"soft");e.load(),this.pages.push(e)}this.createSpread()}}class A{constructor(t,e,s,i){this.direction=t,this.corner=e,this.topIntersectPoint=null,this.sideIntersectPoint=null,this.bottomIntersectPoint=null,this.pageWidth=parseInt(s,10),this.pageHeight=parseInt(i,10)}calc(t){try{return this.position=this.calcAngleAndPosition(t),this.calculateIntersectPoint(this.position),!0}catch{return!1}}getFlippingClipArea(){const t=[];let e=!1;return t.push(this.rect.topLeft),t.push(this.topIntersectPoint),this.sideIntersectPoint===null?e=!0:(t.push(this.sideIntersectPoint),this.bottomIntersectPoint===null&&(e=!1)),t.push(this.bottomIntersectPoint),(e||this.corner==="bottom")&&t.push(this.rect.bottomLeft),t}getBottomClipArea(){const t=[];return t.push(this.topIntersectPoint),this.corner==="top"?t.push({x:this.pageWidth,y:0}):(this.topIntersectPoint!==null&&t.push({x:this.pageWidth,y:0}),t.push({x:this.pageWidth,y:this.pageHeight})),this.sideIntersectPoint!==null?b.GetDistanceBetweenTwoPoint(this.sideIntersectPoint,this.topIntersectPoint)>=10&&t.push(this.sideIntersectPoint):this.corner==="top"&&t.push({x:this.pageWidth,y:this.pageHeight}),t.push(this.bottomIntersectPoint),t.push(this.topIntersectPoint),t}getAngle(){return this.direction===0?-this.angle:this.angle}getRect(){return this.rect}getPosition(){return this.position}getActiveCorner(){return this.direction===0?this.rect.topLeft:this.rect.topRight}getDirection(){return this.direction}getFlippingProgress(){return Math.abs((this.position.x-this.pageWidth)/(2*this.pageWidth)*100)}getCorner(){return this.corner}getBottomPagePosition(){return this.direction===1?{x:this.pageWidth,y:0}:{x:0,y:0}}getShadowStartPoint(){return this.corner==="top"?this.topIntersectPoint:this.sideIntersectPoint!==null?this.sideIntersectPoint:this.topIntersectPoint}getShadowAngle(){const t=b.GetAngleBetweenTwoLine(this.getSegmentToShadowLine(),[{x:0,y:0},{x:this.pageWidth,y:0}]);return this.direction===0?t:Math.PI-t}calcAngleAndPosition(t){let e=t;if(this.updateAngleAndGeometry(e),e=this.corner==="top"?this.checkPositionAtCenterLine(e,{x:0,y:0},{x:0,y:this.pageHeight}):this.checkPositionAtCenterLine(e,{x:0,y:this.pageHeight},{x:0,y:0}),Math.abs(e.x-this.pageWidth)<1&&Math.abs(e.y)<1)throw new Error("Point is too small");return e}updateAngleAndGeometry(t){this.angle=this.calculateAngle(t),this.rect=this.getPageRect(t)}calculateAngle(t){const e=this.pageWidth-t.x+1,s=this.corner==="bottom"?this.pageHeight-t.y:t.y;let i=2*Math.acos(e/Math.sqrt(s*s+e*e));s<0&&(i=-i);const n=Math.PI-i;if(!isFinite(i)||n>=0&&n<.003)throw new Error("The G point is too small");return this.corner==="bottom"&&(i=-i),i}getPageRect(t){return this.corner==="top"?this.getRectFromBasePoint([{x:0,y:0},{x:this.pageWidth,y:0},{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}],t):this.getRectFromBasePoint([{x:0,y:-this.pageHeight},{x:this.pageWidth,y:-this.pageHeight},{x:0,y:0},{x:this.pageWidth,y:0}],t)}getRectFromBasePoint(t,e){return{topLeft:this.getRotatedPoint(t[0],e),topRight:this.getRotatedPoint(t[1],e),bottomLeft:this.getRotatedPoint(t[2],e),bottomRight:this.getRotatedPoint(t[3],e)}}getRotatedPoint(t,e){return{x:t.x*Math.cos(this.angle)+t.y*Math.sin(this.angle)+e.x,y:t.y*Math.cos(this.angle)-t.x*Math.sin(this.angle)+e.y}}calculateIntersectPoint(t){const e={left:-1,top:-1,width:this.pageWidth+2,height:this.pageHeight+2};this.corner==="top"?(this.topIntersectPoint=b.GetIntersectBetweenTwoSegment(e,[t,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=b.GetIntersectBetweenTwoSegment(e,[t,this.rect.bottomLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=b.GetIntersectBetweenTwoSegment(e,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}])):(this.topIntersectPoint=b.GetIntersectBetweenTwoSegment(e,[this.rect.topLeft,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=b.GetIntersectBetweenTwoSegment(e,[t,this.rect.topLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=b.GetIntersectBetweenTwoSegment(e,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}]))}checkPositionAtCenterLine(t,e,s){let i=t;const n=b.LimitPointToCircle(e,this.pageWidth,i);i!==n&&(i=n,this.updateAngleAndGeometry(i));const r=Math.sqrt(Math.pow(this.pageWidth,2)+Math.pow(this.pageHeight,2));let h=this.rect.bottomRight,p=this.rect.topLeft;if(this.corner==="bottom"&&(h=this.rect.topRight,p=this.rect.bottomLeft),h.x<=0){const S=b.LimitPointToCircle(s,r,p);S!==i&&(i=S,this.updateAngleAndGeometry(i))}return i}getSegmentToShadowLine(){const t=this.getShadowStartPoint();return[t,t!==this.sideIntersectPoint&&this.sideIntersectPoint!==null?this.sideIntersectPoint:this.bottomIntersectPoint]}}class ${constructor(t,e){this.flippingPage=null,this.bottomPage=null,this.calc=null,this.state="read",this.render=t,this.app=e}fold(t){this.setState("user_fold"),this.calc===null&&this.start(t),this.do(this.render.convertToPage(t))}flip(t){if(this.app.getSettings().disableFlipByClick&&!this.isPointOnCorners(t)||(this.calc!==null&&this.render.finishAnimation(),!this.start(t)))return;const e=this.getBoundsRect();this.setState("flipping");const s=e.height/10,i=this.calc.getCorner()==="bottom"?e.height-s:s,n=this.calc.getCorner()==="bottom"?e.height:0;this.calc.calc({x:e.pageWidth-s,y:i}),this.animateFlippingTo({x:e.pageWidth-s,y:i},{x:-e.pageWidth,y:n},!0)}start(t){this.reset();const e=this.render.convertToBook(t),s=this.getBoundsRect(),i=this.getDirectionByPoint(e),n=e.y>=s.height/2?"bottom":"top";if(!this.checkDirection(i))return!1;try{if(this.flippingPage=this.app.getPageCollection().getFlippingPage(i),this.bottomPage=this.app.getPageCollection().getBottomPage(i),this.render.getOrientation()==="landscape")if(i===1){const r=this.app.getPageCollection().nextBy(this.flippingPage);r!==null&&this.flippingPage.getDensity()!==r.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),r.setDrawingDensity("hard"))}else{const r=this.app.getPageCollection().prevBy(this.flippingPage);r!==null&&this.flippingPage.getDensity()!==r.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),r.setDrawingDensity("hard"))}return this.render.setDirection(i),this.calc=new A(i,n,s.pageWidth.toString(10),s.height.toString(10)),!0}catch{return!1}}do(t){if(this.calc!==null&&this.calc.calc(t)){const e=this.calc.getFlippingProgress();this.bottomPage.setArea(this.calc.getBottomClipArea()),this.bottomPage.setPosition(this.calc.getBottomPagePosition()),this.bottomPage.setAngle(0),this.bottomPage.setHardAngle(0),this.flippingPage.setArea(this.calc.getFlippingClipArea()),this.flippingPage.setPosition(this.calc.getActiveCorner()),this.flippingPage.setAngle(this.calc.getAngle()),this.calc.getDirection()===0?this.flippingPage.setHardAngle(90*(200-2*e)/100):this.flippingPage.setHardAngle(-90*(200-2*e)/100),this.render.setPageRect(this.calc.getRect()),this.render.setBottomPage(this.bottomPage),this.render.setFlippingPage(this.flippingPage),this.render.setShadowData(this.calc.getShadowStartPoint(),this.calc.getShadowAngle(),e,this.calc.getDirection())}}flipToPage(t,e){const s=this.app.getPageCollection().getCurrentSpreadIndex(),i=this.app.getPageCollection().getSpreadIndexByPage(t);try{i>s&&(this.app.getPageCollection().setCurrentSpreadIndex(i-1),this.flipNext(e)),i<s&&(this.app.getPageCollection().setCurrentSpreadIndex(i+1),this.flipPrev(e))}catch{}}flipNext(t){this.flip({x:this.render.getRect().left+2*this.render.getRect().pageWidth-10,y:t==="top"?1:this.render.getRect().height-2})}flipPrev(t){this.flip({x:10,y:t==="top"?1:this.render.getRect().height-2})}stopMove(){if(this.calc===null)return;const t=this.calc.getPosition(),e=this.getBoundsRect(),s=this.calc.getCorner()==="bottom"?e.height:0;t.x<=0?this.animateFlippingTo(t,{x:-e.pageWidth,y:s},!0):this.animateFlippingTo(t,{x:e.pageWidth,y:s},!1)}showCorner(t){if(!this.checkState("read","fold_corner"))return;const e=this.getBoundsRect(),s=e.pageWidth;if(this.isPointOnCorners(t))if(this.calc===null){if(!this.start(t))return;this.setState("fold_corner"),this.calc.calc({x:s-1,y:1});const i=50,n=this.calc.getCorner()==="bottom"?e.height-1:1,r=this.calc.getCorner()==="bottom"?e.height-i:i;this.animateFlippingTo({x:s-1,y:n},{x:s-i,y:r},!1,!1)}else this.do(this.render.convertToPage(t));else this.setState("read"),this.render.finishAnimation(),this.stopMove()}animateFlippingTo(t,e,s,i=!0){const n=b.GetCordsFromTwoPoint(t,e),r=[];for(const p of n)r.push(()=>this.do(p));const h=this.getAnimationDuration(n.length);this.render.startAnimation(r,h,()=>{this.calc&&(s&&(this.calc.getDirection()===1?this.app.turnToPrevPage():this.app.turnToNextPage()),i&&(this.render.setBottomPage(null),this.render.setFlippingPage(null),this.render.clearShadow(),this.setState("read"),this.reset()))})}getCalculation(){return this.calc}getState(){return this.state}setState(t){this.state!==t&&(this.app.updateState(t),this.state=t)}getDirectionByPoint(t){const e=this.getBoundsRect();if(this.render.getOrientation()==="portrait"){if(t.x-e.pageWidth<=e.width/5)return 1}else if(t.x<e.width/2)return 1;return 0}getAnimationDuration(t){const e=this.app.getSettings().flippingTime;return t>=1e3?e:t/1e3*e}checkDirection(t){return t===0?this.app.getCurrentPageIndex()<this.app.getPageCount()-1:this.app.getCurrentPageIndex()>=1}reset(){this.calc=null,this.flippingPage=null,this.bottomPage=null}getBoundsRect(){return this.render.getRect()}checkState(...t){for(const e of t)if(this.state===e)return!0;return!1}isPointOnCorners(t){const e=this.getBoundsRect(),s=e.pageWidth,i=Math.sqrt(Math.pow(s,2)+Math.pow(e.height,2))/5,n=this.render.convertToBook(t);return n.x>0&&n.y>0&&n.x<e.width&&n.y<e.height&&(n.x<i||n.x>e.width-i)&&(n.y<i||n.y>e.height-i)}}class R{constructor(t,e){this.leftPage=null,this.rightPage=null,this.flippingPage=null,this.bottomPage=null,this.direction=null,this.orientation=null,this.shadow=null,this.animation=null,this.pageRect=null,this.boundsRect=null,this.timer=0,this.safari=!1,this.setting=e,this.app=t;const s=new RegExp("Version\\/[\\d\\.]+.*Safari/");this.safari=s.exec(window.navigator.userAgent)!==null}render(t){if(this.animation!==null){const e=Math.round((t-this.animation.startedAt)/this.animation.durationFrame);e<this.animation.frames.length?this.animation.frames[e]():(this.animation.onAnimateEnd(),this.animation=null)}this.timer=t,this.drawFrame()}start(){this.update();const t=e=>{this.render(e),requestAnimationFrame(t)};requestAnimationFrame(t)}startAnimation(t,e,s){this.finishAnimation(),this.animation={frames:t,duration:e,durationFrame:e/t.length,onAnimateEnd:s,startedAt:this.timer}}finishAnimation(){this.animation!==null&&(this.animation.frames[this.animation.frames.length-1](),this.animation.onAnimateEnd!==null&&this.animation.onAnimateEnd()),this.animation=null}update(){this.boundsRect=null;const t=this.calculateBoundsRect();this.orientation!==t&&(this.orientation=t,this.app.updateOrientation(t))}calculateBoundsRect(){let t="landscape";const e=this.getBlockWidth(),s=e/2,i=this.getBlockHeight()/2,n=this.setting.width/this.setting.height;let r=this.setting.width,h=this.setting.height,p=s-r;return this.setting.size==="stretch"?(e<2*this.setting.minWidth&&this.app.getSettings().usePortrait&&(t="portrait"),r=t==="portrait"?this.getBlockWidth():this.getBlockWidth()/2,r>this.setting.maxWidth&&(r=this.setting.maxWidth),h=r/n,h>this.getBlockHeight()&&(h=this.getBlockHeight(),r=h*n),p=t==="portrait"?s-r/2-r:s-r):e<2*r&&this.app.getSettings().usePortrait&&(t="portrait",p=s-r/2-r),this.boundsRect={left:p,top:i-h/2,width:2*r,height:h,pageWidth:r},t}setShadowData(t,e,s,i){if(!this.app.getSettings().drawShadow)return;const n=100*this.getSettings().maxShadowOpacity;this.shadow={pos:t,angle:e,width:3*this.getRect().pageWidth/4*s/100,opacity:(100-s)*n/100/100,direction:i,progress:2*s}}clearShadow(){this.shadow=null}getBlockWidth(){return this.app.getUI().getDistElement().offsetWidth}getBlockHeight(){return this.app.getUI().getDistElement().offsetHeight}getDirection(){return this.direction}getRect(){return this.boundsRect===null&&this.calculateBoundsRect(),this.boundsRect}getSettings(){return this.app.getSettings()}getOrientation(){return this.orientation}setPageRect(t){this.pageRect=t}setDirection(t){this.direction=t}setRightPage(t){t!==null&&t.setOrientation(1),this.rightPage=t}setLeftPage(t){t!==null&&t.setOrientation(0),this.leftPage=t}setBottomPage(t){t!==null&&t.setOrientation(this.direction===1?0:1),this.bottomPage=t}setFlippingPage(t){t!==null&&t.setOrientation(this.direction===0&&this.orientation!=="portrait"?0:1),this.flippingPage=t}convertToBook(t){const e=this.getRect();return{x:t.x-e.left,y:t.y-e.top}}isSafari(){return this.safari}convertToPage(t,e){e||(e=this.direction);const s=this.getRect();return{x:e===0?t.x-s.left-s.width/2:s.width/2-t.x+s.left,y:t.y-s.top}}convertToGlobal(t,e){if(e||(e=this.direction),t==null)return null;const s=this.getRect();return{x:e===0?t.x+s.left+s.width/2:s.width/2-t.x+s.left,y:t.y+s.top}}convertRectToGlobal(t,e){return e||(e=this.direction),{topLeft:this.convertToGlobal(t.topLeft,e),topRight:this.convertToGlobal(t.topRight,e),bottomLeft:this.convertToGlobal(t.bottomLeft,e),bottomRight:this.convertToGlobal(t.bottomRight,e)}}}class O extends R{constructor(t,e,s){super(t,e),this.canvas=s,this.ctx=s.getContext("2d")}getContext(){return this.ctx}reload(){}drawFrame(){this.clear(),this.orientation!=="portrait"&&this.leftPage!=null&&this.leftPage.simpleDraw(0),this.rightPage!=null&&this.rightPage.simpleDraw(1),this.bottomPage!=null&&this.bottomPage.draw(),this.drawBookShadow(),this.flippingPage!=null&&this.flippingPage.draw(),this.shadow!=null&&(this.drawOuterShadow(),this.drawInnerShadow());const t=this.getRect();this.orientation==="portrait"&&(this.ctx.beginPath(),this.ctx.rect(t.left+t.pageWidth,t.top,t.width,t.height),this.ctx.clip())}drawBookShadow(){const t=this.getRect();this.ctx.save(),this.ctx.beginPath();const e=t.width/20;this.ctx.rect(t.left,t.top,t.width,t.height);const s={x:t.left+t.width/2-e/2,y:0};this.ctx.translate(s.x,s.y);const i=this.ctx.createLinearGradient(0,0,e,0);i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(.4,"rgba(0, 0, 0, 0.2)"),i.addColorStop(.49,"rgba(0, 0, 0, 0.1)"),i.addColorStop(.5,"rgba(0, 0, 0, 0.5)"),i.addColorStop(.51,"rgba(0, 0, 0, 0.4)"),i.addColorStop(1,"rgba(0, 0, 0, 0)"),this.ctx.clip(),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,e,2*t.height),this.ctx.restore()}drawOuterShadow(){const t=this.getRect();this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(t.left,t.top,t.width,t.height);const e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y});this.ctx.translate(e.x,e.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const s=this.ctx.createLinearGradient(0,0,this.shadow.width,0);this.shadow.direction===0?(this.ctx.translate(0,-100),s.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),s.addColorStop(1,"rgba(0, 0, 0, 0)")):(this.ctx.translate(-this.shadow.width,-100),s.addColorStop(0,"rgba(0, 0, 0, 0)"),s.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")")),this.ctx.clip(),this.ctx.fillStyle=s,this.ctx.fillRect(0,0,this.shadow.width,2*t.height),this.ctx.restore()}drawInnerShadow(){const t=this.getRect();this.ctx.save(),this.ctx.beginPath();const e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),s=this.convertRectToGlobal(this.pageRect);this.ctx.moveTo(s.topLeft.x,s.topLeft.y),this.ctx.lineTo(s.topRight.x,s.topRight.y),this.ctx.lineTo(s.bottomRight.x,s.bottomRight.y),this.ctx.lineTo(s.bottomLeft.x,s.bottomLeft.y),this.ctx.translate(e.x,e.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const i=3*this.shadow.width/4,n=this.ctx.createLinearGradient(0,0,i,0);this.shadow.direction===0?(this.ctx.translate(-i,-100),n.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")"),n.addColorStop(.9,"rgba(0, 0, 0, 0.05)"),n.addColorStop(.7,"rgba(0, 0, 0, "+this.shadow.opacity+")"),n.addColorStop(0,"rgba(0, 0, 0, 0)")):(this.ctx.translate(0,-100),n.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),n.addColorStop(.1,"rgba(0, 0, 0, 0.05)"),n.addColorStop(.3,"rgba(0, 0, 0, "+this.shadow.opacity+")"),n.addColorStop(1,"rgba(0, 0, 0, 0)")),this.ctx.clip(),this.ctx.fillStyle=n,this.ctx.fillRect(0,0,i,2*t.height),this.ctx.restore()}clear(){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}class B{constructor(t,e,s){this.touchPoint=null,this.swipeTimeout=250,this.onResize=()=>{this.update()},this.onMouseDown=n=>{if(this.checkTarget(n.target)){const r=this.getMousePos(n.clientX,n.clientY);this.app.startUserTouch(r),n.preventDefault()}},this.onTouchStart=n=>{if(this.checkTarget(n.target)&&n.changedTouches.length>0){const r=n.changedTouches[0],h=this.getMousePos(r.clientX,r.clientY);this.touchPoint={point:h,time:Date.now()},setTimeout(()=>{this.touchPoint!==null&&this.app.startUserTouch(h)},this.swipeTimeout),this.app.getSettings().mobileScrollSupport||n.preventDefault()}},this.onMouseUp=n=>{const r=this.getMousePos(n.clientX,n.clientY);this.app.userStop(r)},this.onMouseMove=n=>{const r=this.getMousePos(n.clientX,n.clientY);this.app.userMove(r,!1)},this.onTouchMove=n=>{if(n.changedTouches.length>0){const r=n.changedTouches[0],h=this.getMousePos(r.clientX,r.clientY);this.app.getSettings().mobileScrollSupport?(this.touchPoint!==null&&(Math.abs(this.touchPoint.point.x-h.x)>10||this.app.getState()!=="read")&&n.cancelable&&this.app.userMove(h,!0),this.app.getState()!=="read"&&n.preventDefault()):this.app.userMove(h,!0)}},this.onTouchEnd=n=>{if(n.changedTouches.length>0){const r=n.changedTouches[0],h=this.getMousePos(r.clientX,r.clientY);let p=!1;if(this.touchPoint!==null){const S=h.x-this.touchPoint.point.x,C=Math.abs(h.y-this.touchPoint.point.y);Math.abs(S)>this.swipeDistance&&C<2*this.swipeDistance&&Date.now()-this.touchPoint.time<this.swipeTimeout&&(S>0?this.app.flipPrev(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"):this.app.flipNext(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"),p=!0),this.touchPoint=null}this.app.userStop(h,p)}},this.parentElement=t,t.classList.add("stf__parent"),t.insertAdjacentHTML("afterbegin",'<div class="stf__wrapper"></div>'),this.wrapper=t.querySelector(".stf__wrapper"),this.app=e;const i=this.app.getSettings().usePortrait?1:2;t.style.minWidth=s.minWidth*i+"px",t.style.minHeight=s.minHeight+"px",s.size==="fixed"&&(t.style.minWidth=s.width*i+"px",t.style.minHeight=s.height+"px"),s.autoSize&&(t.style.width="100%",t.style.maxWidth=2*s.maxWidth+"px"),t.style.display="block",window.addEventListener("resize",this.onResize,!1),this.swipeDistance=s.swipeDistance}destroy(){this.app.getSettings().useMouseEvents&&this.removeHandlers(),this.distElement.remove(),this.wrapper.remove()}getDistElement(){return this.distElement}getWrapper(){return this.wrapper}setOrientationStyle(t){this.wrapper.classList.remove("--portrait","--landscape"),t==="portrait"?(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/this.app.getSettings().width*100+"%"),this.wrapper.classList.add("--portrait")):(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/(2*this.app.getSettings().width)*100+"%"),this.wrapper.classList.add("--landscape")),this.update()}removeHandlers(){window.removeEventListener("resize",this.onResize),this.distElement.removeEventListener("mousedown",this.onMouseDown),this.distElement.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onTouchEnd)}setHandlers(){window.addEventListener("resize",this.onResize,!1),this.app.getSettings().useMouseEvents&&(this.distElement.addEventListener("mousedown",this.onMouseDown),this.distElement.addEventListener("touchstart",this.onTouchStart),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!this.app.getSettings().mobileScrollSupport}),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onTouchEnd))}getMousePos(t,e){const s=this.distElement.getBoundingClientRect();return{x:t-s.left,y:e-s.top}}checkTarget(t){return!this.app.getSettings().clickEventForward||!["a","button"].includes(t.tagName.toLowerCase())}}class H extends B{constructor(t,e,s,i){super(t,e,s),this.wrapper.insertAdjacentHTML("afterbegin",'<div class="stf__block"></div>'),this.distElement=t.querySelector(".stf__block"),this.items=i;for(const n of i)this.distElement.appendChild(n);this.setHandlers()}clear(){for(const t of this.items)this.parentElement.appendChild(t)}updateItems(t){this.removeHandlers(),this.distElement.innerHTML="";for(const e of t)this.distElement.appendChild(e);this.items=t,this.setHandlers()}update(){this.app.getRender().update()}}class G extends B{constructor(t,e,s){super(t,e,s),this.wrapper.innerHTML='<canvas class="stf__canvas"></canvas>',this.canvas=t.querySelectorAll("canvas")[0],this.distElement=this.canvas,this.resizeCanvas(),this.setHandlers()}resizeCanvas(){const t=getComputedStyle(this.canvas),e=parseInt(t.getPropertyValue("width"),10),s=parseInt(t.getPropertyValue("height"),10);this.canvas.width=e,this.canvas.height=s}getCanvas(){return this.canvas}update(){this.resizeCanvas(),this.app.getRender().update()}}class z extends R{constructor(t,e,s){super(t,e),this.outerShadow=null,this.innerShadow=null,this.hardShadow=null,this.hardInnerShadow=null,this.element=s,this.createShadows()}createShadows(){this.element.insertAdjacentHTML("beforeend",`<div class="stf__outerShadow"></div>
             <div class="stf__innerShadow"></div>
             <div class="stf__hardShadow"></div>
             <div class="stf__hardInnerShadow"></div>`),this.outerShadow=this.element.querySelector(".stf__outerShadow"),this.innerShadow=this.element.querySelector(".stf__innerShadow"),this.hardShadow=this.element.querySelector(".stf__hardShadow"),this.hardInnerShadow=this.element.querySelector(".stf__hardInnerShadow")}clearShadow(){super.clearShadow(),this.outerShadow.style.cssText="display: none",this.innerShadow.style.cssText="display: none",this.hardShadow.style.cssText="display: none",this.hardInnerShadow.style.cssText="display: none"}reload(){this.element.querySelector(".stf__outerShadow")||this.createShadows()}drawHardInnerShadow(){const t=this.getRect(),e=this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress;let s=(100-e)*(2.5*t.pageWidth)/100+20;s>t.pageWidth&&(s=t.pageWidth);let i=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+5).toString(10)};
            width: ${s}px;
            height: ${t.height}px;
            background: linear-gradient(to right,
                rgba(0, 0, 0, ${this.shadow.opacity*e/100}) 5%,
                rgba(0, 0, 0, 0) 100%);
            left: ${t.left+t.width/2}px;
            transform-origin: 0 0;
        `;i+=this.getDirection()===0&&this.shadow.progress>100||this.getDirection()===1&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0);":"transform: translate3d(0, 0, 0) rotateY(180deg);",this.hardInnerShadow.style.cssText=i}drawHardOuterShadow(){const t=this.getRect();let e=(100-(this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress))*(2.5*t.pageWidth)/100+20;e>t.pageWidth&&(e=t.pageWidth);let s=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+4).toString(10)};
            width: ${e}px;
            height: ${t.height}px;
            background: linear-gradient(to left, rgba(0, 0, 0, ${this.shadow.opacity}) 5%, rgba(0, 0, 0, 0) 100%);
            left: ${t.left+t.width/2}px;
            transform-origin: 0 0;
        `;s+=this.getDirection()===0&&this.shadow.progress>100||this.getDirection()===1&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0) rotateY(180deg);":"transform: translate3d(0, 0, 0);",this.hardShadow.style.cssText=s}drawInnerShadow(){const t=this.getRect(),e=3*this.shadow.width/4,s=this.getDirection()===0?e:0,i=this.getDirection()===0?"to left":"to right",n=this.convertToGlobal(this.shadow.pos),r=this.shadow.angle+3*Math.PI/2,h=[this.pageRect.topLeft,this.pageRect.topRight,this.pageRect.bottomRight,this.pageRect.bottomLeft];let p="polygon( ";for(const C of h){let M=this.getDirection()===1?{x:-C.x+this.shadow.pos.x,y:C.y-this.shadow.pos.y}:{x:C.x-this.shadow.pos.x,y:C.y-this.shadow.pos.y};M=b.GetRotatedPoint(M,{x:s,y:100},r),p+=M.x+"px "+M.y+"px, "}p=p.slice(0,-2),p+=")";const S=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${e}px;
            height: ${2*t.height}px;
            background: linear-gradient(${i},
                rgba(0, 0, 0, ${this.shadow.opacity}) 5%,
                rgba(0, 0, 0, 0.05) 15%,
                rgba(0, 0, 0, ${this.shadow.opacity}) 35%,
                rgba(0, 0, 0, 0) 100%);
            transform-origin: ${s}px 100px;
            transform: translate3d(${n.x-s}px, ${n.y-100}px, 0) rotate(${r}rad);
            clip-path: ${p};
            -webkit-clip-path: ${p};
        `;this.innerShadow.style.cssText=S}drawOuterShadow(){const t=this.getRect(),e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),s=this.shadow.angle+3*Math.PI/2,i=this.getDirection()===1?this.shadow.width:0,n=this.getDirection()===0?"to right":"to left",r=[{x:0,y:0},{x:t.pageWidth,y:0},{x:t.pageWidth,y:t.height},{x:0,y:t.height}];let h="polygon( ";for(const S of r)if(S!==null){let C=this.getDirection()===1?{x:-S.x+this.shadow.pos.x,y:S.y-this.shadow.pos.y}:{x:S.x-this.shadow.pos.x,y:S.y-this.shadow.pos.y};C=b.GetRotatedPoint(C,{x:i,y:100},s),h+=C.x+"px "+C.y+"px, "}h=h.slice(0,-2),h+=")";const p=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${this.shadow.width}px;
            height: ${2*t.height}px;
            background: linear-gradient(${n}, rgba(0, 0, 0, ${this.shadow.opacity}), rgba(0, 0, 0, 0));
            transform-origin: ${i}px 100px;
            transform: translate3d(${e.x-i}px, ${e.y-100}px, 0) rotate(${s}rad);
            clip-path: ${h};
            -webkit-clip-path: ${h};
        `;this.outerShadow.style.cssText=p}drawLeftPage(){this.orientation!=="portrait"&&this.leftPage!==null&&(this.direction===1&&this.flippingPage!==null&&this.flippingPage.getDrawingDensity()==="hard"?(this.leftPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.leftPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.leftPage.draw(this.flippingPage.getDrawingDensity())):this.leftPage.simpleDraw(0))}drawRightPage(){this.rightPage!==null&&(this.direction===0&&this.flippingPage!==null&&this.flippingPage.getDrawingDensity()==="hard"?(this.rightPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.rightPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.rightPage.draw(this.flippingPage.getDrawingDensity())):this.rightPage.simpleDraw(1))}drawBottomPage(){if(this.bottomPage===null)return;const t=this.flippingPage!=null?this.flippingPage.getDrawingDensity():null;this.orientation==="portrait"&&this.direction===1||(this.bottomPage.getElement().style.zIndex=(this.getSettings().startZIndex+3).toString(10),this.bottomPage.draw(t))}drawFrame(){this.clear(),this.drawLeftPage(),this.drawRightPage(),this.drawBottomPage(),this.flippingPage!=null&&(this.flippingPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.flippingPage.draw()),this.shadow!=null&&this.flippingPage!==null&&(this.flippingPage.getDrawingDensity()==="soft"?(this.drawOuterShadow(),this.drawInnerShadow()):(this.drawHardOuterShadow(),this.drawHardInnerShadow()))}clear(){for(const t of this.app.getPageCollection().getPages())t!==this.leftPage&&t!==this.rightPage&&t!==this.flippingPage&&t!==this.bottomPage&&(t.getElement().style.cssText="display: none"),t.getTemporaryCopy()!==this.flippingPage&&t.hideTemporaryCopy()}update(){super.update(),this.rightPage!==null&&this.rightPage.setOrientation(1),this.leftPage!==null&&this.leftPage.setOrientation(0)}}class P{constructor(){this._default={startPage:0,size:"fixed",width:0,height:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,drawShadow:!0,flippingTime:1e3,usePortrait:!0,startZIndex:0,autoSize:!0,maxShadowOpacity:1,showCover:!1,mobileScrollSupport:!0,swipeDistance:30,clickEventForward:!0,useMouseEvents:!0,showPageCorners:!0,disableFlipByClick:!1}}getSettings(t){const e=this._default;if(Object.assign(e,t),e.size!=="stretch"&&e.size!=="fixed")throw new Error('Invalid size type. Available only "fixed" and "stretch" value');if(e.width<=0||e.height<=0)throw new Error("Invalid width or height");if(e.flippingTime<=0)throw new Error("Invalid flipping time");return e.size==="stretch"?(e.minWidth<=0&&(e.minWidth=100),e.maxWidth<e.minWidth&&(e.maxWidth=2e3),e.minHeight<=0&&(e.minHeight=100),e.maxHeight<e.minHeight&&(e.maxHeight=2e3)):(e.minWidth=e.width,e.maxWidth=e.width,e.minHeight=e.height,e.maxHeight=e.height),e}}(function(a,t){t===void 0&&(t={});var e=t.insertAt;if(typeof document<"u"){var s=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",e==="top"&&s.firstChild?s.insertBefore(i,s.firstChild):s.appendChild(i),i.styleSheet?i.styleSheet.cssText=a:i.appendChild(document.createTextNode(a))}})(`.stf__parent {
  position: relative;
  display: block;
  box-sizing: border-box;
  transform: translateZ(0);

  -ms-touch-action: pan-y;
  touch-action: pan-y;
}

.sft__wrapper {
  position: relative;
  width: 100%;
  box-sizing: border-box;
}

.stf__parent canvas {
  position: absolute;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
}

.stf__block {
  position: absolute;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  perspective: 2000px;
}

.stf__item {
  display: none;
  position: absolute;
  transform-style: preserve-3d;
}

.stf__outerShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__innerShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__hardShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__hardInnerShadow {
  position: absolute;
  left: 0;
  top: 0;
}`),W.PageFlip=class extends class{constructor(){this.events=new Map}on(a,t){return this.events.has(a)?this.events.get(a).push(t):this.events.set(a,[t]),this}off(a){this.events.delete(a)}trigger(a,t,e=null){if(this.events.has(a))for(const s of this.events.get(a))s({data:e,object:t})}}{constructor(a,t){super(),this.isUserTouch=!1,this.isUserMove=!1,this.setting=null,this.pages=null,this.setting=new P().getSettings(t),this.block=a}destroy(){this.ui.destroy(),this.block.remove()}update(){this.render.update(),this.pages.show()}loadFromImages(a){this.ui=new G(this.block,this,this.setting);const t=this.ui.getCanvas();this.render=new O(this,this.setting,t),this.flipController=new $(this.render,this),this.pages=new x(this,this.render,a),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}loadFromHTML(a){this.ui=new H(this.block,this,this.setting,a),this.render=new z(this,this.setting,this.ui.getDistElement()),this.flipController=new $(this.render,this),this.pages=new D(this,this.render,this.ui.getDistElement(),a),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}updateFromImages(a){const t=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new x(this,this.render,a),this.pages.load(),this.pages.show(t),this.trigger("update",this,{page:t,mode:this.render.getOrientation()})}updateFromHtml(a){const t=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new D(this,this.render,this.ui.getDistElement(),a),this.pages.load(),this.ui.updateItems(a),this.render.reload(),this.pages.show(t),this.trigger("update",this,{page:t,mode:this.render.getOrientation()})}clear(){this.pages.destroy(),this.ui.clear()}turnToPrevPage(){this.pages.showPrev()}turnToNextPage(){this.pages.showNext()}turnToPage(a){this.pages.show(a)}flipNext(a="top"){this.flipController.flipNext(a)}flipPrev(a="top"){this.flipController.flipPrev(a)}flip(a,t="top"){this.flipController.flipToPage(a,t)}updateState(a){this.trigger("changeState",this,a)}updatePageIndex(a){this.trigger("flip",this,a)}updateOrientation(a){this.ui.setOrientationStyle(a),this.update(),this.trigger("changeOrientation",this,a)}getPageCount(){return this.pages.getPageCount()}getCurrentPageIndex(){return this.pages.getCurrentPageIndex()}getPage(a){return this.pages.getPage(a)}getRender(){return this.render}getFlipController(){return this.flipController}getOrientation(){return this.render.getOrientation()}getBoundsRect(){return this.render.getRect()}getSettings(){return this.setting}getUI(){return this.ui}getState(){return this.flipController.getState()}getPageCollection(){return this.pages}startUserTouch(a){this.mousePosition=a,this.isUserTouch=!0,this.isUserMove=!1}userMove(a,t){this.isUserTouch||t||!this.setting.showPageCorners?this.isUserTouch&&b.GetDistanceBetweenTwoPoint(this.mousePosition,a)>5&&(this.isUserMove=!0,this.flipController.fold(a)):this.flipController.showCorner(a)}userStop(a,t=!1){this.isUserTouch&&(this.isUserTouch=!1,t||(this.isUserMove?this.flipController.stopMove():this.flipController.flip(a)))}},Object.defineProperty(W,"__esModule",{value:!0})}))})(Q,Q.exports)),Q.exports}var Kt=Zt();const Qt={class:"mx-auto w-full max-w-[980px] px-1 sm:px-2"},Xt={key:0,class:"book-skeleton","aria-hidden":"true"},Jt=["data-density"],te={key:0,class:"cover-frame cover-frame-outer"},ee={class:"cover-frame cover-frame-inner cover-centered"},se={class:"cover-logo-wrap"},ie=["src","alt"],ne={key:1,class:"cover-logo-fallback"},re={class:"cover-university-name"},oe={class:"cover-title"},ae={class:"cover-subtitle"},he={class:"cover-quote"},le={class:"book-running-header"},ce={class:"intro-layout"},de={class:"intro-context"},ue={class:"intro-context-university"},ge={class:"intro-context-class"},pe={class:"intro-quote-wrap"},me={class:"intro-quote"},fe={class:"intro-signature"},ve={class:"intro-stats"},we={class:"intro-stat-value"},ye={class:"intro-stat-label"},xe={class:"book-running-header"},be={class:"intro-layout intro-right-layout"},Pe={class:"intro-course-name"},Se={class:"intro-copy"},ke={class:"book-running-header"},_e={class:"student-list"},Ce=["src","alt","onError"],Ie=["alt"],Te={class:"student-content"},$e={class:"student-name"},Re={key:0,class:"student-nickname"},De={key:1,class:"student-quote"},Le={key:4,class:"cover-frame cover-frame-outer"},Ee={key:5,class:"book-page-number"},Me={key:0,class:"book-navigation"},Ae=["disabled"],Be=["disabled"],We="/images/default-profile.svg",It=3,He=at({__name:"CohortBook",props:{university:{},course:{},cohort:{},students:{},totalStudents:{}},setup(m){const y=m,W=["Dreams are earned one quiet, consistent day at a time.","The work was hard, and that is exactly why it matters.","The future belongs to those who finish what they start.","Discipline writes the story that talent begins.","Small progress, repeated daily, becomes legacy.","Courage is showing up when no one is watching.","Growth begins where comfort ends.","Stay humble, stay curious, and keep building.","Great journeys are made of ordinary days done well.","Every challenge became a chapter in this success.","Keep the faith, trust the process, finish strong.","What once felt impossible is now your proof.","Your effort today becomes someone else inspiration tomorrow.","Excellence is a habit before it is a headline.","The best stories are written by those who persist.","We arrived with hope, and we leave with purpose."],I=k(null),T=k(null),_=k(0),x=k(null),b=k(!1),L=k(!1),D=k(!1),A=k(!1),$=k(!1),R=k(!1),O=k(!1),B=k({width:0,height:0}),H=k(0),G=k(!1),z=k(new Set),P=k(null);let a=null,t=null;const e=f(()=>{const l=String(y.cohort.year??"").trim();if(/^\d{4}$/.test(l))return l;const v=[y.cohort.name,y.cohort.slug].find(w=>typeof w=="string"&&w.trim()!=="")?.match(/(19|20)\d{2}/)?.[0];return typeof v=="string"?v:String(new Date().getFullYear())}),s=f(()=>y.university?.name??"University"),i=f(()=>s.value.split(/\s+/).filter(l=>l.trim()!=="").slice(0,3).map(l=>l[0]?.toUpperCase()??"").join("")),n=f(()=>{if(G.value)return null;const l=y.university?.media?.[0],c=l?.conversions?.full??l?.conversions?.thumb??l?.original_url??null;return c===null||c.trim()===""?null:c}),r=f(()=>{const l=y.course.short_name?.trim();return l!==""?l.toUpperCase():i.value}),h=f(()=>[...y.students].sort((l,c)=>l.name.localeCompare(c.name,void 0,{sensitivity:"base"}))),p=l=>{if(z.value.has(l.id))return null;const c=l.media?.[0]?.conversions?.full??l.media?.[0]?.conversions?.thumb??l.media?.[0]?.original_url??null;return c===null||c.trim()===""?null:c},S=l=>{z.value.has(l)||(z.value=new Set([...z.value,l]))},C=l=>{const c=(l??"").trim();if(c==="")return null;const v=c.split(/\s+/).filter(w=>w!=="");return v.length>8?v.slice(0,8).join(" "):c},M=f(()=>y.totalStudents<=h.value.length),U=f(()=>Math.max(y.totalStudents,h.value.length)),ht=f(()=>{if(!M.value)return null;const l=h.value.map(v=>v.department?.trim().toLowerCase()??"").filter(v=>v!==""),c=new Set(l);return c.size>0?c.size:null}),lt=f(()=>{if(!M.value)return null;const l=h.value.map(v=>{const w=v.location?.trim()??"";if(w==="")return"";const q=w.split(",").map(Y=>Y.trim()).filter(Y=>Y!=="");return q.length>0?q[q.length-1].toLowerCase():""}).filter(v=>v!==""),c=new Set(l);return c.size>0?c.size:null}),Mt=f(()=>{const l=`${y.course.id}-${y.cohort.id}`;let c=0;for(let v=0;v<l.length;v+=1)c=c*31+l.charCodeAt(v)>>>0;return c%W.length}),ct=f(()=>W[Mt.value]),dt=f(()=>{const l=[];for(let c=0;c<h.value.length;c+=It)l.push(h.value.slice(c,c+It));return l}),nt=f(()=>`${y.course.short_name.toUpperCase()} Class of ${e.value}`),ut=f(()=>dt.value.length+3),At=f(()=>{const l=[{label:"graduates",value:String(U.value)},{label:"nights of grinding",value:"1095"},{label:"lectures",value:"300+"}];return ht.value!==null&&l.splice(1,0,{label:"departments",value:String(ht.value)}),lt.value!==null&&l.push({label:"countries",value:String(lt.value)}),l}),Bt=f(()=>b.value?{width:"min(370px, calc(100vw - 1rem))",height:"min(560px, 78vh)"}:{width:"min(920px, calc(100vw - 2rem))",height:"min(680px, 82vh)"}),X=f(()=>{const l=[{id:"cover-front",kind:"cover",density:"hard",pageNumber:null},{id:"intro-left",kind:"intro-left",pageNumber:1},{id:"intro-right",kind:"intro-right",pageNumber:2}];return dt.value.forEach((c,v)=>{l.push({id:`students-${v}`,kind:"students",students:c,pageNumber:v+3})}),l.push({id:"cover-back",kind:"back",density:"hard",pageNumber:ut.value}),l}),Wt=f(()=>`${X.value.map(l=>l.id).join("|")}::${h.value.map(l=>`${l.id}-${l.name}-${l.nickname??""}-${l.quote??""}`).join("|")}`),gt=f(()=>H.value>0),pt=f(()=>H.value<X.value.length-1),mt=()=>{b.value=window.matchMedia("(max-width: 767px)").matches},J=()=>{if(I.value===null)return!1;const l=Math.round(I.value.clientWidth),c=Math.round(I.value.clientHeight);return l!==B.value.width||c!==B.value.height?(B.value={width:l,height:c},!0):!1},tt=async()=>{await Lt(),await new Promise(l=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{l()})})})},Ht=()=>T.value===null?[]:Array.from(T.value.querySelectorAll(".page")),ft=()=>{x.value!==null&&(x.value.off("flip"),x.value.off("init"),x.value.off("update"),x.value.off("changeOrientation"),x.value.off("changeState"),x.value.destroy(),x.value=null,$.value=!1,H.value=0)},vt=async(l=0)=>{if(D.value)return;D.value=!0,L.value=!1,await tt();const c=T.value;if(c===null){D.value=!1;return}const v=Math.max(0,Math.min(l,X.value.length-1)),w=new Kt.PageFlip(c,{width:460,height:660,size:"stretch",minWidth:220,maxWidth:460,minHeight:380,maxHeight:660,showCover:!0,mobileScrollSupport:!0,usePortrait:!0,flippingTime:900,startZIndex:10,maxShadowOpacity:.35,drawShadow:!0,disableFlipByClick:!0,startPage:v});w.on("changeState",Y=>{const ot=String(Y.data);$.value=ot!=="read",ot==="read"&&(et(),R.value&&(R.value=!1,rt()),O.value&&(O.value=!1,wt()))}),w.on("init",async()=>{await tt(),w.getCurrentPageIndex()!==v&&w.turnToPage(v),et(),J(),L.value=!0,D.value=!1}),w.on("flip",()=>{et()});const q=Ht();x.value=w,w.loadFromHTML(q),A.value=!0},Ft=async()=>{const l=x.value?.getCurrentPageIndex()??0;ft(),_.value+=1,await tt(),await vt(l)},rt=()=>{if($.value){R.value=!0;return}a!==null&&clearTimeout(a),a=setTimeout(async()=>{x.value===null||D.value||(await tt(),x.value.update())},140)},wt=()=>{if(A.value){if($.value){O.value=!0;return}t!==null&&clearTimeout(t),t=setTimeout(async()=>{await Ft()},90)}},yt=()=>{mt(),J()&&rt()},et=()=>{x.value!==null&&(H.value=x.value.getCurrentPageIndex())},xt=l=>{if(x.value===null)return;const c=x.value,v=c.getCurrentPageIndex(),w=c.getSettings(),q=w.disableFlipByClick;w.disableFlipByClick=!1,l==="next"?c.flipNext("top"):c.flipPrev("top"),w.disableFlipByClick=q,setTimeout(()=>{if(x.value===null)return;const Y=x.value.getCurrentPageIndex();x.value.getState()==="read"&&Y===v&&(l==="next"?x.value.turnToNextPage():x.value.turnToPrevPage(),et())},90)},bt=()=>{$.value||!gt.value||x.value===null||xt("prev")},Pt=()=>{$.value||!pt.value||x.value===null||xt("next")},St=l=>{l.key==="ArrowLeft"&&(l.preventDefault(),bt()),l.key==="ArrowRight"&&(l.preventDefault(),Pt())};return Rt(async()=>{mt(),await vt(0),J(),typeof ResizeObserver<"u"&&I.value!==null&&(P.value=new ResizeObserver(()=>{J()&&rt()}),P.value.observe(I.value)),window.addEventListener("resize",yt,{passive:!0}),window.addEventListener("keydown",St)}),zt(()=>{window.removeEventListener("resize",yt),window.removeEventListener("keydown",St),P.value!==null&&(P.value.disconnect(),P.value=null),a!==null&&clearTimeout(a),t!==null&&clearTimeout(t),ft()}),Ot(Wt,()=>{wt()},{flush:"post"}),(l,c)=>(d(),g("section",Qt,[o("div",{ref_key:"stageRef",ref:I,class:"book-stage mx-auto",style:Gt(Bt.value)},[c[8]||(c[8]=o("div",{class:"book-spine-shadow","aria-hidden":"true"},null,-1)),L.value?E("",!0):(d(),g("div",Xt)),(d(),g("div",{key:_.value,ref_key:"bookRef",ref:T,class:it(["cohort-book-host",{"book-host-hidden":!L.value}])},[(d(!0),g(F,null,N(X.value,v=>(d(),g("div",{key:v.id,"data-density":v.density??"soft",class:it(["page","book-page",`page-${v.kind}`])},[v.kind==="cover"?(d(),g("div",te,[o("div",ee,[o("div",se,[n.value?(d(),g("img",{key:0,src:n.value,alt:s.value,class:"cover-logo",loading:"lazy",referrerpolicy:"no-referrer",onError:c[0]||(c[0]=w=>G.value=!0)},null,40,ie)):(d(),g("div",ne,u(i.value),1)),o("p",re,u(s.value),1)]),o("h3",oe,u(r.value),1),o("p",ae,"Class of "+u(e.value),1),c[1]||(c[1]=o("p",{class:"cover-kicker"},"DIGITAL YEARBOOK",-1)),o("p",he,u(ct.value),1)])])):v.kind==="intro-left"?(d(),g(F,{key:1},[o("p",le,u(nt.value),1),o("div",ce,[o("div",de,[o("p",ue,u(s.value),1),o("p",ge,"Class of "+u(e.value),1)]),o("div",pe,[c[2]||(c[2]=o("p",{class:"intro-quote-mark"},'"',-1)),o("p",me,u(ct.value),1),c[3]||(c[3]=o("p",{class:"intro-divider"},null,-1)),o("p",fe,"- THE CLASS OF "+u(e.value),1)]),o("div",ve,[(d(!0),g(F,null,N(At.value,w=>(d(),g("div",{key:w.label,class:"intro-stat"},[o("p",we,u(w.value),1),o("p",ye,u(w.label),1)]))),128))])])],64)):v.kind==="intro-right"?(d(),g(F,{key:2},[o("p",xe,u(nt.value),1),o("div",be,[c[4]||(c[4]=o("p",{class:"intro-heading-sm"},"MEET THE GRADUATES",-1)),c[5]||(c[5]=o("h3",{class:"intro-heading-lg"},"Our Stars",-1)),o("p",Pe,u(m.course.name),1),c[6]||(c[6]=o("p",{class:"intro-divider"},null,-1)),o("p",Se," The following pages celebrate the brilliant minds and spirited souls who make up the Class of "+u(e.value)+". ",1)])],64)):v.kind==="students"?(d(),g(F,{key:3},[o("p",ke,u(nt.value),1),o("div",_e,[(d(!0),g(F,null,N(v.students,w=>(d(),Z(V(st),{key:w.id,href:`/@${w.username}`,class:"student-entry"},{default:K(()=>[p(w)?(d(),g("img",{key:0,src:p(w)??"",alt:w.name,class:"student-photo",loading:"lazy",referrerpolicy:"no-referrer",onError:q=>S(w.id)},null,40,Ce)):(d(),g("img",{key:1,src:We,alt:`${w.name} profile placeholder`,class:"student-photo",loading:"lazy",referrerpolicy:"no-referrer"},null,8,Ie)),o("div",Te,[o("p",$e,u(w.name),1),w.nickname&&w.nickname.trim()!==""?(d(),g("p",Re,' "'+u(w.nickname)+'" ',1)):E("",!0),C(w.quote)?(d(),g("p",De,' "'+u(C(w.quote))+'" ',1)):E("",!0)])]),_:2},1032,["href"]))),128))])],64)):(d(),g("div",Le,[...c[7]||(c[7]=[Dt('<div class="cover-frame cover-frame-inner cover-centered" data-v-d9f401d8><h3 class="cover-title" data-v-d9f401d8>The End</h3><p class="back-signoff" data-v-d9f401d8>Made with love by JRonnie</p><p class="back-email" data-v-d9f401d8>jronnie@thetechtower.com</p><a href="https://jronnie.thetechtower.com" target="_blank" rel="noopener noreferrer" class="back-link" data-v-d9f401d8> jronnie.thetechtower.com </a></div>',1)])])),v.pageNumber!==null?(d(),g("p",Ee," Page "+u(v.pageNumber)+" of "+u(ut.value),1)):E("",!0)],10,Jt))),128))],2))],4),L.value?(d(),g("div",Me,[o("button",{type:"button",class:"book-nav-button",disabled:!gt.value||$.value,"aria-label":"Go to previous page",onClick:bt},[...c[9]||(c[9]=[o("i",{class:"fa-solid fa-chevron-left text-xs"},null,-1)])],8,Ae),o("button",{type:"button",class:"book-nav-button",disabled:!pt.value||$.value,"aria-label":"Go to next page",onClick:Pt},[...c[10]||(c[10]=[o("i",{class:"fa-solid fa-chevron-right text-xs"},null,-1)])],8,Be)])):E("",!0)]))}}),Fe=Et(He,[["__scopeId","data-v-d9f401d8"]]),ze={class:"cohort-print-root"},Oe={class:"print-page print-cover-page"},Ge={class:"print-cover-frame print-cover-frame-outer"},qe={class:"print-cover-frame print-cover-frame-inner"},Ye={class:"print-cover-logo-wrap"},Ue=["src","alt"],Ne={key:1,class:"print-cover-logo-fallback"},je={class:"print-cover-university"},Ve={class:"print-cover-course"},Ze={class:"print-cover-class"},Ke={class:"print-page print-intro-page"},Qe={class:"print-running-header"},Xe={class:"print-intro-layout"},Je={class:"print-intro-context"},ts={class:"print-intro-university"},es={class:"print-intro-class"},ss={class:"print-intro-quote"},is={class:"print-intro-signature"},ns={class:"print-intro-stats"},rs={class:"print-intro-stat-value"},os={class:"print-intro-stat-label"},as={class:"print-page-number"},hs={class:"print-page print-intro-page"},ls={class:"print-running-header"},cs={class:"print-intro-layout print-intro-right-layout"},ds={class:"print-intro-course-name"},us={class:"print-intro-copy"},gs={class:"print-page-number"},ps={class:"print-running-header"},ms={class:"print-student-list"},fs=["src","alt","onError"],vs=["alt"],ws={class:"print-student-content"},ys={class:"print-student-name"},xs={key:0,class:"print-student-profession"},bs={key:1,class:"print-student-nickname"},Ps={key:2,class:"print-student-quote"},Ss={class:"print-page-number"},ks={class:"print-page print-back-page"},_s={class:"print-page-number"},Tt=3,Cs="/images/default-profile.svg",Is=at({__name:"CohortBookPrint",props:{university:{},course:{},cohort:{},students:{},totalStudents:{}},setup(m){const y=m,W=["Dreams are earned one quiet, consistent day at a time.","The work was hard, and that is exactly why it matters.","The future belongs to those who finish what they start.","Discipline writes the story that talent begins.","Small progress, repeated daily, becomes legacy.","Courage is showing up when no one is watching.","Growth begins where comfort ends.","Stay humble, stay curious, and keep building.","Great journeys are made of ordinary days done well.","Every challenge became a chapter in this success.","Keep the faith, trust the process, finish strong.","What once felt impossible is now your proof.","Your effort today becomes someone else inspiration tomorrow.","Excellence is a habit before it is a headline.","The best stories are written by those who persist.","We arrived with hope, and we leave with purpose."],I=k(!1),T=k(new Set),_=f(()=>{const s=String(y.cohort.year??"").trim();if(/^\d{4}$/.test(s))return s;const n=[y.cohort.name,y.cohort.slug].find(r=>typeof r=="string"&&r.trim()!=="")?.match(/(19|20)\d{2}/)?.[0];return typeof n=="string"?n:String(new Date().getFullYear())}),x=f(()=>y.university?.name??"University"),b=f(()=>`${y.course.short_name.toUpperCase()} Class of ${_.value}`),L=f(()=>x.value.split(/\s+/).filter(s=>s.trim()!=="").slice(0,3).map(s=>s[0]?.toUpperCase()??"").join("")),D=f(()=>{if(I.value)return null;const s=y.university?.media?.[0],i=s?.conversions?.full??s?.conversions?.thumb??s?.original_url??null;return i===null||i.trim()===""?null:i}),A=f(()=>[...y.students].sort((s,i)=>s.name.localeCompare(i.name,void 0,{sensitivity:"base"}))),$=f(()=>{const s=[];for(let i=0;i<A.value.length;i+=Tt)s.push(A.value.slice(i,i+Tt));return s}),R=f(()=>$.value.length+3),O=f(()=>Math.max(y.totalStudents,A.value.length)),B=f(()=>{const s=A.value.map(n=>n.department?.trim().toLowerCase()??"").filter(n=>n!==""),i=new Set(s);return i.size>0?i.size:null}),H=f(()=>{const s=A.value.map(n=>{const r=n.location?.trim()??"";if(r==="")return"";const h=r.split(",").map(p=>p.trim()).filter(p=>p!=="");return h.length>0?h[h.length-1].toLowerCase():""}).filter(n=>n!==""),i=new Set(s);return i.size>0?i.size:null}),G=f(()=>{const s=`${y.course.id}-${y.cohort.id}`;let i=0;for(let n=0;n<s.length;n+=1)i=i*31+s.charCodeAt(n)>>>0;return i%W.length}),z=f(()=>W[G.value]),P=f(()=>{const s=[{label:"graduates",value:String(O.value)},{label:"nights of grinding",value:"1095"},{label:"lectures",value:"300+"}];return B.value!==null&&s.splice(1,0,{label:"departments",value:String(B.value)}),H.value!==null&&s.push({label:"countries",value:String(H.value)}),s}),a=s=>{if(T.value.has(s.id))return null;const i=s.media?.[0]?.conversions?.full??s.media?.[0]?.conversions?.thumb??s.media?.[0]?.original_url??null;return i===null||i.trim()===""?null:i},t=s=>{T.value.has(s)||(T.value=new Set([...T.value,s]))},e=s=>{const i=(s??"").trim();if(i==="")return null;const n=i.split(/\s+/).filter(r=>r!=="");return n.length>8?n.slice(0,8).join(" "):i};return(s,i)=>(d(),g("div",ze,[o("article",Oe,[o("div",Ge,[o("div",qe,[o("div",Ye,[D.value?(d(),g("img",{key:0,src:D.value,alt:x.value,class:"print-cover-logo",loading:"eager",referrerpolicy:"no-referrer",onError:i[0]||(i[0]=n=>I.value=!0)},null,40,Ue)):(d(),g("div",Ne,u(L.value),1))]),o("p",je,u(x.value),1),o("p",Ve,u(m.course.name),1),o("h1",Ze,"Class of "+u(_.value),1),i[1]||(i[1]=o("p",{class:"print-cover-kicker"},"DIGITAL YEARBOOK",-1))])])]),o("article",Ke,[o("p",Qe,u(b.value),1),o("div",Xe,[o("div",Je,[o("p",ts,u(x.value),1),o("p",es,"Class of "+u(_.value),1)]),i[2]||(i[2]=o("p",{class:"print-intro-mark"},'"',-1)),o("p",ss,u(z.value),1),o("p",is,"- THE CLASS OF "+u(_.value),1),o("div",ns,[(d(!0),g(F,null,N(P.value,n=>(d(),g("div",{key:n.label,class:"print-intro-stat"},[o("p",rs,u(n.value),1),o("p",os,u(n.label),1)]))),128))])]),o("p",as,"Page 1 of "+u(R.value),1)]),o("article",hs,[o("p",ls,u(b.value),1),o("div",cs,[i[3]||(i[3]=o("p",{class:"print-intro-heading-sm"},"MEET THE GRADUATES",-1)),i[4]||(i[4]=o("h2",{class:"print-intro-heading-lg"},"Our Stars",-1)),o("p",ds,u(m.course.name),1),o("p",us," The following pages celebrate the brilliant minds and spirited souls who make up the Class of "+u(_.value)+". ",1)]),o("p",gs,"Page 2 of "+u(R.value),1)]),(d(!0),g(F,null,N($.value,(n,r)=>(d(),g("article",{key:`students-page-${r}`,class:"print-page print-students-page"},[o("p",ps,u(b.value),1),o("div",ms,[(d(!0),g(F,null,N(n,h=>(d(),g("div",{key:h.id,class:"print-student-card"},[a(h)?(d(),g("img",{key:0,src:a(h)??"",alt:h.name,class:"print-student-photo",loading:"eager",referrerpolicy:"no-referrer",onError:p=>t(h.id)},null,40,fs)):(d(),g("img",{key:1,src:Cs,alt:`${h.name} profile placeholder`,class:"print-student-photo",loading:"eager",referrerpolicy:"no-referrer"},null,8,vs)),o("div",ws,[o("p",ys,u(h.name),1),h.profession&&h.profession.trim()!==""?(d(),g("p",xs,u(h.profession),1)):E("",!0),h.nickname&&h.nickname.trim()!==""?(d(),g("p",bs,' "'+u(h.nickname)+'" ',1)):E("",!0),e(h.quote)?(d(),g("p",Ps,' "'+u(e(h.quote))+'" ',1)):E("",!0)])]))),128))]),o("p",Ss,"Page "+u(r+3)+" of "+u(R.value),1)]))),128)),o("article",ks,[i[5]||(i[5]=Dt('<div class="print-back-inner" data-v-7f056c66><h2 class="print-back-title" data-v-7f056c66>The End</h2><p class="print-back-subtitle" data-v-7f056c66>Made with love by JRonnie</p><p class="print-back-email" data-v-7f056c66>jronnie@thetechtower.com</p><p class="print-back-link" data-v-7f056c66>jronnie.thetechtower.com</p></div>',1)),o("p",_s,"Page "+u(R.value)+" of "+u(R.value),1)])]))}}),$t=Et(Is,[["__scopeId","data-v-7f056c66"]]),Ts={key:0,class:"bg-white px-4 py-6 text-black"},$s={class:"no-print"},Rs={class:"py-10"},Ds={class:"mx-auto mt-6 max-w-4xl text-center text-4xl font-semibold tracking-wide text-foreground sm:text-5xl"},Ls={class:"mx-auto mt-6 grid w-[90%] grid-cols-1 gap-2 text-center text-sm text-muted-foreground md:grid-cols-3"},Es={class:"font-medium"},Ms={class:"font-medium"},As={class:"font-medium"},Bs={key:0,class:"mt-4 text-center text-sm text-muted-foreground"},Ws={class:"mx-auto mt-5 flex w-[90%] flex-wrap items-center justify-between gap-3"},Hs={key:0,class:"flex w-full items-center gap-3 sm:w-auto"},Fs={key:0,class:"w-full max-w-md sm:w-[22rem]"},zs={key:1},Os={class:"flex flex-wrap items-center gap-2"},Gs={class:"inline-flex items-center rounded-md border border-border bg-background p-1 text-xs font-medium"},qs={key:0,class:"grid grid-cols-2 gap-x-5 gap-y-8 py-10 sm:grid-cols-3 lg:grid-cols-4"},Ys={class:"overflow-hidden border border-border bg-card"},Us=["src","alt"],Ns={key:1,class:"flex aspect-[3/4] w-full items-center justify-center bg-muted text-muted-foreground"},js={class:"mt-3 truncate text-center text-sm font-semibold uppercase"},Vs={key:0,class:"col-span-full text-center text-sm text-muted-foreground"},Zs={key:1,class:"py-10"},Ks={class:"flex items-center justify-between pb-10"},Qs={key:1},Xs={key:0,class:"print-only"},gi=at({__name:"Show",props:{courseYear:{},students:{},printStudents:{},search:{},view:{},printOnly:{type:Boolean}},setup(m){const y=m,W=Yt(),I=k(""),T=k(y.search),_=k(y.view==="grid"?"grid":"book"),x=f(()=>y.printOnly),b=f(()=>W.props.auth.user),L=f(()=>b.value!==null&&b.value.roles.includes("superadmin")),D=k(y.search.trim()!==""),A=f(()=>`${y.courseYear.course.short_name.toUpperCase()} Class of ${y.courseYear.year}`),$=`course-student-search-${y.courseYear.id}`;let R=null;const O=()=>{window.print()},B=P=>{const a=P.media?.[0]?.conversions?.full??P.media?.[0]?.conversions?.thumb??P.media?.[0]?.original_url??null;return a===null||a.trim()===""?null:a},H=()=>{_.value==="grid"&&(R!==null&&clearTimeout(R),R=setTimeout(()=>{_t.get(`/${y.courseYear.slug}`,{search:T.value,view:_.value},{preserveScroll:!0,preserveState:!0,replace:!0})},350))},G=P=>{_.value!==P&&(P==="book"&&(T.value="",D.value=!1),_.value=P,_t.get(`/${y.courseYear.slug}`,{search:P==="grid"?T.value:"",view:P},{preserveScroll:!0,preserveState:!0,replace:!0}))},z=async()=>{D.value=!0,await Lt(),document.getElementById($)?.focus()};return Rt(()=>{I.value=window.location.href}),(P,a)=>(d(),g(F,null,[j(V(qt),{title:`${m.courseYear.course.name} - ${P.$page.props.appName}`},null,8,["title"]),x.value?(d(),g("div",Ts,[j($t,{university:m.courseYear.course.university??null,course:m.courseYear.course,cohort:m.courseYear,students:m.printStudents,"total-students":m.printStudents.length},null,8,["university","course","cohort","students","total-students"])])):(d(),Z(jt,{key:1},{default:K(()=>[o("div",$s,[o("section",Rs,[a[4]||(a[4]=o("div",{class:"mx-auto w-[90%] space-y-2"},[o("div",{class:"h-px bg-border"}),o("div",{class:"h-px bg-border/70"})],-1)),o("h1",Ds,u(A.value),1),a[5]||(a[5]=o("div",{class:"mx-auto mt-6 h-px w-[90%] bg-border"},null,-1)),o("div",Ls,[o("p",Es,u(m.courseYear.course.university?.name),1),o("p",Ms,u(m.courseYear.course.name),1),o("p",As,u(m.courseYear.year),1)]),m.courseYear.course.nickname?(d(),g("p",Bs," AKA: "+u(m.courseYear.course.nickname),1)):E("",!0),o("div",Ws,[_.value==="grid"?(d(),g("div",Hs,[o("button",{type:"button",class:"inline-flex h-10 w-10 items-center justify-center rounded-md border border-border bg-background text-foreground transition hover:bg-accent","aria-label":"Open student search",onClick:z},[...a[3]||(a[3]=[o("i",{class:"fa-solid fa-magnifying-glass text-sm"},null,-1)])]),D.value?(d(),g("div",Fs,[j(V(Nt),{id:$,modelValue:T.value,"onUpdate:modelValue":a[0]||(a[0]=t=>T.value=t),placeholder:"Search by name or username...",onInput:H},null,8,["modelValue"])])):E("",!0)])):(d(),g("div",zs)),o("div",Os,[o("div",Gs,[o("button",{type:"button",class:it(["rounded px-3 py-1.5 transition",_.value==="grid"?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-accent"]),onClick:a[1]||(a[1]=t=>G("grid"))}," Grid ",2),o("button",{type:"button",class:it(["rounded px-3 py-1.5 transition",_.value==="book"?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-accent"]),onClick:a[2]||(a[2]=t=>G("book"))}," Book ",2)]),L.value?(d(),g("button",{key:0,type:"button",class:"rounded-md border border-border bg-background px-3 py-2 text-xs font-medium transition hover:bg-accent",onClick:O}," Print ")):E("",!0),j(Ut,{inline:"",url:I.value,title:`${m.courseYear.course.name} Class of ${m.courseYear.year} - ${P.$page.props.appName}`},null,8,["url","title"])])])]),_.value==="grid"?(d(),g("section",qs,[(d(!0),g(F,null,N(m.students.data,t=>(d(),Z(V(st),{key:t.id,href:`/@${t.username}`,class:"group block"},{default:K(()=>[o("div",Ys,[B(t)?(d(),g("img",{key:0,src:B(t)??"",alt:t.name,class:"aspect-[3/4] w-full object-cover transition-transform duration-300 group-hover:scale-[1.03]",loading:"lazy"},null,8,Us)):(d(),g("div",Ns,[...a[6]||(a[6]=[o("i",{class:"fa-solid fa-user text-4xl"},null,-1)])]))]),o("p",js,u(t.name),1)]),_:2},1032,["href"]))),128)),m.students.data.length===0?(d(),g("p",Vs," No results ")):E("",!0)])):(d(),g("section",Zs,[j(Fe,{university:m.courseYear.course.university??null,course:m.courseYear.course,cohort:m.courseYear,students:m.students.data,"total-students":m.students.total??m.students.data.length},null,8,["university","course","cohort","students","total-students"])])),o("section",Ks,[m.students.prev_page_url?(d(),Z(V(st),{key:0,href:m.students.prev_page_url,class:"rounded-md border border-border px-3 py-1.5 text-sm"},{default:K(()=>[...a[7]||(a[7]=[kt("Previous",-1)])]),_:1},8,["href"])):(d(),g("div",Qs)),m.students.next_page_url?(d(),Z(V(st),{key:2,href:m.students.next_page_url,class:"rounded-md border border-border px-3 py-1.5 text-sm"},{default:K(()=>[...a[8]||(a[8]=[kt("Next",-1)])]),_:1},8,["href"])):E("",!0)])]),L.value?(d(),g("div",Xs,[j($t,{university:m.courseYear.course.university??null,course:m.courseYear.course,cohort:m.courseYear,students:m.printStudents,"total-students":m.printStudents.length},null,8,["university","course","cohort","students","total-students"])])):E("",!0)]),_:1}))],64))}});export{gi as default};
